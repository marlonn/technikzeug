<!DOCTYPE html>
<html>
<head>
{% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'artikel/style.css' %}" />
    <meta content="text/html">
    <title>technikzeugs heim</title>
</head>
<body>
<div id="search-container">

  <h3>Technikzeugs - Artikel</h3>

  <div id="form-container-suchseite">
      <form id="searchform" action="" method="get">
         <button class="searchbutton" type="submit">suchen</button>
         <input class="searchfield" id="searchbox" name="q"
                type="text" placeholder="enter search term">
      </form>
  </div>

  {% if request.GET %}
      <div id="ergebnis-h4">
          <h4>Ergebnisse f√ºr tag "{{ request.GET.q }}"</h4>
      </div>
  {% endif %}

  {% if artikel_list %}
      <ul>
      {% for artikel in artikel_list %}
           <li class="ergebnis" id="{{ artikel.a_id }}">
<!--                 <a href="/artikel/{{ artikel.a_id }}/" id="{{ artikel.a_id }}"> -->
                <span class="datum">{{ artikel.datum|date:"Y-m-d" }}</span>
                <span class="titel">{{ artikel.titel }}</span>
<!--                 </a> -->
                <div class="txt"></div>
           </li>
      {% endfor %}
      </ul>
  {% else %}
      <p>No articles found. Do not use more than one search term.</p>
  {% endif %}

</div> <!-- search-container -->

<script>
    // this allows you to enter search terms directly after loading the page
    document.getElementById('searchbox').focus();

    // just a sanity check
//     function bgColorHover(){
//         this.style = "background-color: blue;"
//     }
//     document.querySelectorAll('.ergebnis').forEach(el => {
//         el.addEventListener('mouseover', bgColorHover);
//     });
    
    function getArtikelText(id){
        fetch('http://10.98.228.171/artikel/api/' + id + '?json')
        .then(response => response.json()) 
        .then(responseData => {
//             console.log(responseData);
//             console.log(responseData.titel);
//             console.log(responseData.text);
            return responseData.text;
        });
    }
    function attachArtikelText(id){
        fetch('http://10.98.228.171/artikel/api/' + id + '?json')
        .then(response => response.json()) 
        .then(responseData => {
            let elErgebnis = document.getElementById(id);
//             elErgebnis.style = "background-color: darkblue; color: white;"
            let div = elErgebnis.getElementsByClassName("txt")[0];
            console.log(div);
            div.innerHTML = responseData.text;
        });
    }
    function attachOnClick(){
        let id = this.id;
        console.log("attachOnClick id: " + id);
        if(this.getElementsByClassName("txt")[0].innerHTML){
            // if user clicks again, remove artikel-text
            this.getElementsByClassName("txt")[0].innerHTML = "";
        }else{
            // display artikel-text, accordion-style
            attachArtikelText(id);
        }
    }
    document.querySelectorAll('.ergebnis').forEach(el => {
        el.addEventListener('click', attachOnClick);
    });
</script>
</body>
</html>
